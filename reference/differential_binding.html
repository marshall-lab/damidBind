<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Differential binding/expression analysis (`limma`) — differential_binding • damidBind</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Differential binding/expression analysis (`limma`) — differential_binding"><meta name="description" content="Setup and differential analysis for occupancy/binding experiments
using `limma`. Accepts output from `load_data_peaks` or `load_data_genes`,
prepares an experiment matrix, fits linear models, and returns DE loci."><meta property="og:description" content="Setup and differential analysis for occupancy/binding experiments
using `limma`. Accepts output from `load_data_peaks` or `load_data_genes`,
prepares an experiment matrix, fits linear models, and returns DE loci."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">damidBind</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/damidBind_vignette.html">damidBind</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/marshall-lab/damidBind/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Differential binding/expression analysis (`limma`)</h1>
      <small class="dont-index">Source: <a href="https://github.com/marshall-lab/damidBind/blob/HEAD/R/limma_functions.R" class="external-link"><code>R/limma_functions.R</code></a></small>
      <div class="d-none name"><code>differential_binding.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Setup and differential analysis for occupancy/binding experiments
using `limma`. Accepts output from `load_data_peaks` or `load_data_genes`,
prepares an experiment matrix, fits linear models, and returns DE loci.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">differential_binding</span><span class="op">(</span></span>
<span>  <span class="va">data_list</span>,</span>
<span>  <span class="va">cond</span>,</span>
<span>  regex <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  fdr <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  filter_negative_occupancy <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  filter_positive_enrichment <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data-list">data_list<a class="anchor" aria-label="anchor" href="#arg-data-list"></a></dt>
<dd><p>List. Output from load_data_peaks or load_data_genes.</p></dd>


<dt id="arg-cond">cond<a class="anchor" aria-label="anchor" href="#arg-cond"></a></dt>
<dd><p>A named or unnamed character vector of length two. The values are
strings or regular expressions used to identify samples for each condition.
If the vector is named, the names are used as user-friendly display names
for the conditions in plots and outputs. If unnamed, the match strings are
used as display names. The order determines the contrast, e.g., `cond[1]` vs `cond[2]`.</p></dd>


<dt id="arg-regex">regex<a class="anchor" aria-label="anchor" href="#arg-regex"></a></dt>
<dd><p>Logical. If `TRUE`, the strings in `cond` are treated as
regular expressions for matching sample names. If `FALSE` (the default),
fixed string matching is used.</p></dd>


<dt id="arg-fdr">fdr<a class="anchor" aria-label="anchor" href="#arg-fdr"></a></dt>
<dd><p>Numeric. FDR threshold for significance (default 0.05).</p></dd>


<dt id="arg-filter-negative-occupancy">filter_negative_occupancy<a class="anchor" aria-label="anchor" href="#arg-filter-negative-occupancy"></a></dt>
<dd><p>NULL or integer.  If a positive integer, only
loci with positive occupancy in fewer than this number of samples per condition
will be filtered out prior to differential analysis. (default: 2).</p></dd>


<dt id="arg-filter-positive-enrichment">filter_positive_enrichment<a class="anchor" aria-label="anchor" href="#arg-filter-positive-enrichment"></a></dt>
<dd><p>Logical. If `TRUE` (default), regions
are only considered significantly enriched if the mean score in the
enriched condition is greater than zero. For example, for a region to be
in `upCond1`, its logFC must be positive and its mean score in condition 1
must be &gt; 0. This is a common biological filter to focus on regions with
genuine binding enrichment, rather than changes between two states of
depletion. Set to `FALSE` to include all statistically significant changes.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A `DamIDResults` object containing the results. Access slots using
  accessors:</p>
<dl><dt>enrichedCond1()</dt>
<dd><p>data.frame of regions enriched in condition 1</p></dd>

  <dt>enrichedCond2()</dt>
<dd><p>data.frame of regions enriched in condition 2</p></dd>

  <dt>analysisTable()</dt>
<dd><p>data.frame of full results for all tested regions</p></dd>

  <dt>conditionNames()</dt>
<dd><p>A named character vector mapping display names to internal condition names</p></dd>

  <dt>inputData()</dt>
<dd><p>The original `data_list` input</p></dd>

</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Create a mock GRanges object for gene annotations</span></span></span>
<span class="r-in"><span><span class="co"># This object, based on the package's unit tests, avoids network access.</span></span></span>
<span class="r-in"><span><span class="va">mock_genes_gr</span> <span class="op">&lt;-</span> <span class="fu">GenomicRanges</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html" class="external-link">GRanges</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    seqnames <span class="op">=</span> <span class="fu">S4Vectors</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Rle-class.html" class="external-link">Rle</a></span><span class="op">(</span><span class="st">"2L"</span>, <span class="fl">7</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    ranges <span class="op">=</span> <span class="fu">IRanges</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/IRanges-constructor.html" class="external-link">IRanges</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">2000</span>, <span class="fl">3000</span>, <span class="fl">5000</span>, <span class="fl">6000</span>, <span class="fl">7000</span>, <span class="fl">8000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1500</span>, <span class="fl">2500</span>, <span class="fl">3500</span>, <span class="fl">5500</span>, <span class="fl">6500</span>, <span class="fl">7500</span>, <span class="fl">20000000</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    strand <span class="op">=</span> <span class="fu">S4Vectors</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Rle-class.html" class="external-link">Rle</a></span><span class="op">(</span><span class="fu">GenomicRanges</span><span class="fu">::</span><span class="fu">strand</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="st">"-"</span>, <span class="st">"+"</span>, <span class="st">"+"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>, <span class="st">"+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    gene_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FBgn001"</span>, <span class="st">"FBgn002"</span>, <span class="st">"FBgn003"</span>, <span class="st">"FBgn004"</span>, <span class="st">"FBgn005"</span>, <span class="st">"FBgn006"</span>, <span class="st">"FBgn007"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    gene_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geneA"</span>, <span class="st">"geneB"</span>, <span class="st">"geneC"</span>, <span class="st">"geneD"</span>, <span class="st">"geneE"</span>, <span class="st">"geneF"</span>, <span class="st">"LargeTestGene"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get path to sample data files included with the package</span></span></span>
<span class="r-in"><span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"damidBind"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Load data</span></span></span>
<span class="r-in"><span><span class="va">loaded_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="load_data_peaks.html">load_data_peaks</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    binding_profiles_path <span class="op">=</span> <span class="va">data_dir</span>,</span></span>
<span class="r-in"><span>    peaks_path <span class="op">=</span> <span class="va">data_dir</span>,</span></span>
<span class="r-in"><span>    ensdb_genes <span class="op">=</span> <span class="va">mock_genes_gr</span>,</span></span>
<span class="r-in"><span>    quantile_norm <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Locating binding profile files</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Building binding profile dataframe from input files ...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  - Loaded: Bsh_Dam_L4_r1-ext300-vs-Dam.kde-norm</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  - Loaded: Bsh_Dam_L4_r2-ext300-vs-Dam.kde-norm</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  - Loaded: Bsh_Dam_L5_r1-ext300-vs-Dam.kde-norm</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  - Loaded: Bsh_Dam_L5_r2-ext300-vs-Dam.kde-norm</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Applying quantile normalisation</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Locating peak files</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculating occupancy over peaks</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculating average occupancy for 1208 regions...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run differential binding analysis</span></span></span>
<span class="r-in"><span><span class="va">diff_results</span> <span class="op">&lt;-</span> <span class="fu">differential_binding</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">loaded_data</span>,</span></span>
<span class="r-in"><span>    cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L4 Neurons"</span> <span class="op">=</span> <span class="st">"L4"</span>, <span class="st">"L5 Neurons"</span> <span class="op">=</span> <span class="st">"L5"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Condition display names were sanitized for internal data:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   'L4 Neurons' -&gt; 'L4.Neurons'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   'L5 Neurons' -&gt; 'L5.Neurons'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Applying filter: Loci must have occupancy &gt; 0 in at least 2 samples of at least one condition.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Filtered out 12 loci. 1196 loci remain for analysis.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Differential analysis setup:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Condition 1 Display Name: 'L4 Neurons' (Internal: 'L4.Neurons', Match Pattern: 'L4')</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Found 2 replicates:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Bsh_Dam_L4_r1-ext300-vs-Dam.kde-norm_qnorm</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Bsh_Dam_L4_r2-ext300-vs-Dam.kde-norm_qnorm</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Condition 2 Display Name: 'L5 Neurons' (Internal: 'L5.Neurons', Match Pattern: 'L5')</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Found 2 replicates:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Bsh_Dam_L5_r1-ext300-vs-Dam.kde-norm_qnorm</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Bsh_Dam_L5_r2-ext300-vs-Dam.kde-norm_qnorm</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> limma contrasts: L4.Neurons-L5.Neurons</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtering for positive enrichment (mean score &gt; 0 in the enriched condition).</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 284 loci enriched in L4 Neurons</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Highest-ranked genes:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> LargeTestGene, LargeTestGene, LargeTestGene, LargeTestGene, LargeTestGene, LargeTestGene, LargeTestGene, LargeTestGene, LargeTestGene, LargeTestGene</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 173 loci enriched in L5 Neurons</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Highest-ranked genes:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> LargeTestGene, LargeTestGene, LargeTestGene, LargeTestGene, LargeTestGene, LargeTestGene, LargeTestGene, LargeTestGene, LargeTestGene, LargeTestGene</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View the results summary</span></span></span>
<span class="r-in"><span><span class="va">diff_results</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An object of class 'DamIDResults'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Differentially bound regions</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Comparison: 'L4 Neurons' vs 'L5 Neurons'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 284 regions enriched in L4 Neurons</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 173 regions enriched in L5 Neurons</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 1196 total regions tested</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Owen Marshall.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

